<div class="client-container">
    <h2>Lista de Clientes</h2>

    <div class="search-bar">
        <input
            type="text"
            placeholder="Pesquisar por nome ou CPF..."
            [(ngModel)]="search"
            (keyup.enter)="filterClients()"
        />
        <button class="btn-search" (click)="filterClients()">
            <i class="bi bi-search"></i> Pesquisar
        </button>
    </div>

    <div *ngIf="isLoading" class="loading-message">
        <div class="spinner"></div>
        <span>Carregando dados...</span>
    </div>

    <div *ngIf="!isLoading" class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>CPF</th>
                    <th>Nome</th>
                    <th>Cidade/UF</th>
                    <th>Saldo</th>
                    <th>Limite</th>
                    <th>Ações</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let cliente of pgClients">
                    <td>{{ cliente.cpf | cpf }}</td>
                    <td>{{ cliente.nome }}</td>
                    <td>
                        <span *ngIf="cliente.endereco">
                            {{ cliente.endereco.cidade }} /
                            {{ cliente.endereco.estado }}
                        </span>
                        <span *ngIf="!cliente.endereco"> - </span>
                    </td>

                    <td
                        [class.negative]="(cliente.saldo || 0) < 0"
                        [class.positive]="(cliente.saldo || 0) >= 0"
                    >
                        {{ cliente.saldo | currency : "BRL" }}
                    </td>

                    <td class="positive">
                        {{ cliente.limite | currency : "BRL" }}
                    </td>

                    <td class="actions">
                        <button
                            class="details-button"
                            (click)="viewClient(cliente)"
                        >
                            <i class="bi bi-eye-fill"></i> Detalhes
                        </button>
                    </td>
                </tr>

                <tr *ngIf="pgClients.length === 0">
                    <td colspan="6" class="no-results">
                        Nenhum cliente encontrado para esta pesquisa.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="pg-controls" *ngIf="totalPgs > 1">
        <button (click)="previousPg()" [disabled]="currentPg === 1">
            &laquo; Anterior
        </button>
        <span>Página {{ currentPg }} de {{ totalPgs }}</span>
        <button (click)="nextPg()" [disabled]="currentPg === totalPgs">
            Próximo &raquo;
        </button>
    </div>
</div>
