<div class="client-container">
    <h2>Relatório de Clientes</h2>

    <div class="search-bar">
        <input
            type="text"
            placeholder="Pesquisar por nome ou CPF..."
            [(ngModel)]="searchTerm"
            (keyup.enter)="onSearch()"
        />
        <button class="btn-search" (click)="onSearch()">
            <i class="bi bi-search"></i> Pesquisar
        </button>
    </div>

    <div *ngIf="isLoading" class="loading-message">
        <div class="spinner"></div>
        <span>Gerando relatório consolidado...</span>
    </div>

    <div *ngIf="!isLoading" class="table-wrapper">
        <table>
            <thead>
                <tr>
                    <th>CPF</th>
                    <th>Nome</th>
                    <th>E-mail</th>
                    <th>Salário</th>
                    <th>Nº Conta</th>
                    <th>Saldo</th>
                    <th>Limite</th>
                    <th>Gerente Responsável</th>
                </tr>
            </thead>
            <tbody>
                <tr *ngFor="let cliente of pgClients">
                    <td>{{ cliente.cpf | cpf }}</td>

                    <td>{{ cliente.nome }}</td>
                    <td>{{ cliente.email }}</td>

                    <td>{{ cliente.salario | currency : "BRL" }}</td>
                    <td>{{ cliente.conta || "-" }}</td>

                    <td
                        [class.negative]="(cliente.saldo || 0) < 0"
                        [class.positive]="(cliente.saldo || 0) >= 0"
                    >
                        {{ cliente.saldo | currency : "BRL" }}
                    </td>

                    <td class="positive">
                        {{ cliente.limite | currency : "BRL" }}
                    </td>

                    <td>
                        <!-- CORREÇÃO: Removido o '?' pois o manager é garantido pelo Service -->
                        <div
                            *ngIf="
                                cliente.manager.nome &&
                                cliente.manager.nome !== 'Não Atribuído'
                            "
                        >
                            <strong>{{ cliente.manager.nome }}</strong>
                            <div class="small-text">
                                CPF: {{ cliente.manager.cpf | cpf }}
                            </div>
                        </div>
                        <span
                            *ngIf="
                                !cliente.manager.nome ||
                                cliente.manager.nome === 'Não Atribuído'
                            "
                            class="no-data"
                        >
                            Não Atribuído
                        </span>
                    </td>
                </tr>

                <tr *ngIf="pgClients.length === 0">
                    <td colspan="8" class="no-results">
                        Nenhum cliente encontrado.
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <div class="pg-controls" *ngIf="totalPgs > 1">
        <button (click)="previousPg()" [disabled]="currentPg === 1">
            &laquo; Anterior
        </button>

        <span>Página {{ currentPg }} de {{ totalPgs }}</span>

        <button (click)="nextPg()" [disabled]="currentPg === totalPgs">
            Próxima &raquo;
        </button>
    </div>
</div>
